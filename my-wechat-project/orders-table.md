## LangChain 智能处理框架

当AI需要基于本订单知识库执行**自动化、多步骤的复杂任务**（如“分析退款原因趋势”、“生成订单周报”）时，应遵循以下框架，充分利用LangChain的六大模块进行编排：

### 核心模块调用策略
1.  **模型 I/O (Models)**：
    *   **调用要点**：将业务问题（如“统计上周的异常订单”）转化为结构化的分析请求发送给大模型。
    *   **示例指令**：“你是一个数据分析师，请根据提供的订单数据和规则，分析以下问题：{用户问题}”

2.  **提示词链 (Prompts & Chains)**：
    *   **调用要点**：构建多步骤的提示词链来处理订单生命周期问题。
    *   **示例链**：
        *   **步骤1 (提取)**：“从用户问题中提取关键参数：时间范围、订单状态、分析维度。”
        *   **步骤2 (查询)**：“根据上述参数，构思需要向数据库查询哪些数据字段。”
        *   **步骤3 (分析)**：“基于查询结果和业务规则（如‘退款规则’），执行分析并生成见解。”

3.  **数据检索 (Retrieval)**：
    *   **调用要点**：将本文档（`orders-table.md`）本身作为知识库，当任务涉及具体规则（如“订单状态转换规则”）时，从中检索相关段落作为上下文提供给模型。

4.  **智能代理 (Agents)**：
    *   **调用要点**：用于处理非确定性的、需要决策的任务。例如，用户问“这个订单应该同意退款吗？”，代理应能按`思考->行动->观察`循环工作：
        *   **思考**：我需要查询该订单的详细状态、支付时间和退款政策。
        *   **行动**：调用“查询订单详情”工具。
        *   **观察**：工具返回结果。发现订单已发货超过7天，不符合政策。
        *   **最终答案**：不应同意退款。

5.  **记忆 (Memory)**：
    *   **调用要点**：在涉及多轮对话的分析中（如用户连续追问不同维度的订单数据），使用对话记忆来保持上下文连贯，记住之前已查询过的订单ID或时间范围。

6.  **工具 (Tools)**：
    *   **调用要点**：为代理定义处理订单所需的具体工具。基于本文档，可抽象出以下工具：
        *   `query_orders_by_status`：根据状态查询订单。
        *   `calculate_order_statistics`：计算订单金额、数量等统计信息。
        *   `simulate_order_flow`：根据“订单生命周期”规则，模拟给定订单的下一步可能状态。

### 框架应用示例
**用户请求**：“帮我分析一下上周所有‘已取消’的订单，列出主要原因，并给出减少取消率的建议。”

**LangChain驱动的工作流**：
1.  **代理规划**：此任务需要查询、统计、归因和建议，是一个多步骤工作流。
2.  **链式执行**：
    *   链1：调用 `query_orders_by_status(‘cancelled’， time_range=‘last_week’)` 工具获取数据。
    *   链2：将数据与`orders-table.md`中“取消规则”结合，通过大模型进行原因归类。
    *   链3：基于归类结果，让大模型生成业务建议。
3.  **输出整合**：将数据结果、分析原因和建议格式化为最终报告。